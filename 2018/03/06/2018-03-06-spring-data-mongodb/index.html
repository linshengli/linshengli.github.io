<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java,spring,mongodb,spring-boot," />










<meta name="description" content="spring-data-mongodb1. mapping(定义Document)所有的映射均由org.springframework.data.mongodb.core.convert.MappingMongoConverter类实现。几点基准：  每个类均映射为一个mongodb中的Collection，Collection的名称使用驼峰式命名。 除@DbRef指定的属性之外，所有的属性均保存">
<meta name="keywords" content="Java,spring,mongodb,spring-boot">
<meta property="og:type" content="article">
<meta property="og:title" content="spring-data-mongodb">
<meta property="og:url" content="http://yoursite.com/2018/03/06/2018-03-06-spring-data-mongodb/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="spring-data-mongodb1. mapping(定义Document)所有的映射均由org.springframework.data.mongodb.core.convert.MappingMongoConverter类实现。几点基准：  每个类均映射为一个mongodb中的Collection，Collection的名称使用驼峰式命名。 除@DbRef指定的属性之外，所有的属性均保存">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-03-06T16:12:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="spring-data-mongodb">
<meta name="twitter:description" content="spring-data-mongodb1. mapping(定义Document)所有的映射均由org.springframework.data.mongodb.core.convert.MappingMongoConverter类实现。几点基准：  每个类均映射为一个mongodb中的Collection，Collection的名称使用驼峰式命名。 除@DbRef指定的属性之外，所有的属性均保存">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/03/06/2018-03-06-spring-data-mongodb/"/>





  <title>spring-data-mongodb | Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/06/2018-03-06-spring-data-mongodb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Tbxsx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">spring-data-mongodb</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-06T00:00:00+08:00">
                2018-03-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="spring-data-mongodb"><a href="#spring-data-mongodb" class="headerlink" title="spring-data-mongodb"></a>spring-data-mongodb</h2><h3 id="1-mapping-定义Document"><a href="#1-mapping-定义Document" class="headerlink" title="1. mapping(定义Document)"></a>1. mapping(定义Document)</h3><p>所有的映射均由<code>org.springframework.data.mongodb.core.convert.MappingMongoConverter</code>类实现。<br>几点基准：</p>
<ul>
<li>每个类均映射为一个mongodb中的Collection，Collection的名称使用驼峰式命名。</li>
<li>除@DbRef指定的属性之外，所有的属性均保存在该类中，包括嵌入在该类里的类。</li>
</ul>
<h4 id="1-1-id字段的映射"><a href="#1-1-id字段的映射" class="headerlink" title="1.1 _id字段的映射"></a>1.1 _id字段的映射</h4><p>@Id,@Field,id（属性名为id）均可用来指定_id。<br>|Field definition|Resulting Id-Fieldname in MongoDB|<br>|:—:|:—:|<br>|String id|_id|<br>|@Field String id|_id|<br>|@Field(“x”) String id|x|<br>|@Id String x|_id|<br>|@Field(“x”) @Id String x|_id|<br>|||<br><a href="https://docs.spring.io/spring-data/mongodb/docs/2.0.5.RELEASE/reference/html/#mapping.conventions.id-field" target="_blank" rel="noopener">TODO 如果id不能转化为一个ObjectId怎么办？</a></p>
<h4 id="1-2-映射的type对应"><a href="#1-2-映射的type对应" class="headerlink" title="1.2 映射的type对应"></a>1.2 映射的type对应</h4><table>
<thead>
<tr>
<th style="text-align:center">Type</th>
<th style="text-align:center">Type conversion</th>
<th style="text-align:center">Sample</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">String</td>
<td style="text-align:center">native</td>
<td style="text-align:center">{“firstname” : “Dave”}</td>
</tr>
</tbody>
</table>
<p>double, Double, float, Float|native|{“weight” : 42.5}|<br>int, Integer, short, Short|native 32-bit integer|{“height” : 42}<br>long, Long|native 64-bit integer|{“height” : 42}|<br>Date, Timestamp|native|{“date” : ISODate(“2019-11-12T23:00:00.809Z”)}|<br>Array, List, BasicDBList|native|{“cookies” : [ … ]}<br><a href="https://docs.spring.io/spring-data/mongodb/docs/2.0.5.RELEASE/reference/html/#mapping-conversion" target="_blank" rel="noopener">TODO test array?</a></p>
<h4 id="1-3-注解-Mapping-annotation-overview"><a href="#1-3-注解-Mapping-annotation-overview" class="headerlink" title="1.3 注解(Mapping annotation overview)"></a>1.3 注解(Mapping annotation overview)</h4><ul>
<li><p><code>@Id</code> - applied at the field level to mark the field used for identity purpose.</p>
</li>
<li><p><code>@Document</code> - applied at the class level to indicate this class is a candidate for mapping to the database. You can specify the name of the collection where the database will be stored.</p>
</li>
<li><p><code>@DBRef</code> - applied at the field to indicate it is to be stored using a com.mongodb.DBRef.</p>
</li>
<li><p><code>@Indexed</code> - applied at the field level to describe how to index the field.</p>
</li>
<li><p><code>@CompoundIndex</code> - applied at the type level to declare Compound Indexes</p>
</li>
<li><p><code>@GeoSpatialIndexed</code> - applied at the field level to describe how to geoindex the field.</p>
</li>
<li><p><code>@TextIndexed</code> - applied at the field level to mark the field to be included in the text index.</p>
</li>
<li><p><code>@Language</code> - applied at the field level to set the language override property for text index.</p>
</li>
<li><p><code>@Transient</code> - by default all private fields are mapped to the document, this annotation excludes the field where it is applied from being stored in the database</p>
</li>
<li><p><code>@PersistenceConstructor</code> - marks a given constructor - even a package protected one - to use when instantiating the object from the database. Constructor arguments are mapped by name to the key values in the retrieved Document.</p>
</li>
<li><p><code>@Value</code> - this annotation is part of the Spring Framework . Within the mapping framework it can be applied to constructor arguments. This lets you use a Spring Expression Language statement to transform a key’s value retrieved in the database before it is used to construct a domain object. In order to reference a property of a given document one has to use expressions like: <code>@Value(&quot;#root.myProperty&quot;)</code> where root refers to the root of the given document.</p>
</li>
<li><p><code>@Field</code> - applied at the field level and described the name of the field as it will be represented in the MongoDB BSON document thus allowing the name to be different than the fieldname of the class.</p>
</li>
<li><p><code>@Version</code> - applied at field level is used for optimistic locking and checked for modification on save operations. The initial value is zero which is bumped automatically on every update.<br><a href="https://docs.spring.io/spring-data/mongodb/docs/2.0.5.RELEASE/reference/html/#mongo-template.optimistic-locking" target="_blank" rel="noopener">记录的版本，示例</a></p>
</li>
</ul>
<p><code>@TypeAlias(&quot;pers&quot;)</code>在mongodb中该类的_class为pers。<br><code>@PersistenceConstructor</code>标记一个构造器，指定用来构造类的实例，并可以结合<code>@Value</code>使用，可以达到修改构造器用处。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Document</span><br><span class="line">	static class ObjectContainer &#123;</span><br><span class="line"></span><br><span class="line">		@Field(&quot;property&quot;) private final PrimitiveContainer m_property;</span><br><span class="line"></span><br><span class="line">		@PersistenceConstructor</span><br><span class="line">		public ObjectContainer(@Value(&quot;#root.property&quot;) PrimitiveContainer a_property) &#123;</span><br><span class="line">			m_property = a_property;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		public PrimitiveContainer property() &#123;</span><br><span class="line">			return m_property;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-操作Mongodb"><a href="#2-操作Mongodb" class="headerlink" title="2. 操作Mongodb"></a>2. 操作Mongodb</h3><p>最常用的两个操作Mongodb的类是MongoTemple，Repository类。</p>
<h4 id="2-1-连接Mongodb"><a href="#2-1-连接Mongodb" class="headerlink" title="2.1 连接Mongodb"></a>2.1 连接Mongodb</h4><p>使用MongoClient<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public MongoClient mongoClient() &#123;</span><br><span class="line">    return new MongoClient();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>常用的MongoClient类构造方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public MongoClient(String host) &#123;</span><br><span class="line">    this(new ServerAddress(host));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public MongoClient(String host, int port) &#123;</span><br><span class="line">    this(new ServerAddress(host, port));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public MongoClient(ServerAddress addr) &#123;</span><br><span class="line">    this(addr, (new Builder()).build());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public MongoClient(MongoClientURI uri) &#123;</span><br><span class="line">    super(uri);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>MongoClientFactoryBean</code>对应MongoClient的工厂模式，可以用来构建MongoClient（<code>createInstance方法</code>）。</p>
</blockquote>
<h4 id="2-2-使用MongoTemple"><a href="#2-2-使用MongoTemple" class="headerlink" title="2.2 使用MongoTemple"></a>2.2 使用MongoTemple</h4><p>MongoTemple的三种构造方法</p>
<ol>
<li><p><code>MongoTemplate(MongoClient mongo, String databaseName)</code> - takes the com.mongodb.MongoClient object and the default database name to operate against.</p>
</li>
<li><p><code>MongoTemplate(MongoDbFactory mongoDbFactory)</code> - takes a MongoDbFactory object that encapsulated the com.mongodb.MongoClient object, database name, and username and password.</p>
</li>
<li><p><code>MongoTemplate(MongoDbFactory mongoDbFactory, MongoConverter mongoConverter)</code> - adds a MongoConverter to use for mapping.</p>
</li>
</ol>
<p>MongoTemple的CRUD：</p>
<p>插入数据:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">void save (Object objectToSave) Save the object to the default collection.</span><br><span class="line"></span><br><span class="line">void save (Object objectToSave, String collectionName) Save the object to the specified collection.</span><br><span class="line"></span><br><span class="line">A similar set of insert operations is listed below</span><br><span class="line"></span><br><span class="line">void insert (Object objectToSave) Insert the object to the default collection.</span><br><span class="line"></span><br><span class="line">void insert (Object objectToSave, String collectionName) Insert the object to the specified collection.</span><br></pre></td></tr></table></figure></p>
<p>区别:<br>insert在出现相同的id的时候，会出现错误，而save会覆盖原值。(只限于id)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insertAll(Collection objectionsToSave)</span><br><span class="line">insert methods that take a Collection as the first argument. This inserts a list of objects in a single batch write to the database.</span><br></pre></td></tr></table></figure>
<p>Update:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">updateFirst Updates the first document that matches the query document criteria with the provided updated document.</span><br><span class="line"></span><br><span class="line">updateMulti Updates all objects that match the query document criteria with the provided updated document.</span><br></pre></td></tr></table></figure></p>
<p>常见的update方法的示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WriteResult wr = mongoTemplate.updateMulti(new Query(where(&quot;accounts.accountType&quot;).is(Account.Type.SAVINGS)),</span><br><span class="line">  new Update().inc(&quot;accounts.$.balance&quot;, 50.00), Account.class);</span><br></pre></td></tr></table></figure></p>
<p>Update的方法(和mongodb中的原生update方法类似)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[TODO to review]</span><br><span class="line"></span><br><span class="line">Update addToSet (String key, Object value) Update using the $addToSet update modifier</span><br><span class="line">Update currentDate (String key) Update using the $currentDate update modifier</span><br><span class="line">Update currentTimestamp (String key) Update using the $currentDate update modifier with $type timestamp</span><br><span class="line">Update inc (String key, Number inc) Update using the $inc update modifier</span><br><span class="line">Update max (String key, Object max) Update using the $max update modifier</span><br><span class="line">Update min (String key, Object min) Update using the $min update modifier</span><br><span class="line">Update multiply (String key, Number multiplier) Update using the $mul update modifier</span><br><span class="line">Update pop (String key, Update.Position pos) Update using the $pop update modifier</span><br><span class="line">Update pull (String key, Object value) Update using the $pull update modifier</span><br><span class="line">Update pullAll (String key, Object[] values) Update using the $pullAll update modifier</span><br><span class="line">Update push (String key, Object value) Update using the $push update modifier</span><br><span class="line">Update pushAll (String key, Object[] values) Update using the $pushAll update modifier</span><br><span class="line">Update rename (String oldName, String newName) Update using the $rename update modifier</span><br><span class="line">Update set (String key, Object value) Update using the $set update modifier</span><br><span class="line">Update setOnInsert (String key, Object value) Update using the $setOnInsert update modifier</span><br><span class="line">Update unset (String key) Update using the $unset update modifier</span><br></pre></td></tr></table></figure></p>
<p>删除数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">template.remove(tywin, &quot;GOT&quot;);                                          &lt;1&gt;    </span><br><span class="line">template.remove(query(where(&quot;lastname&quot;).is(&quot;lannister&quot;)), &quot;GOT&quot;);       &lt;2&gt;  </span><br><span class="line">template.remove(new Query().limit(3), &quot;GOT&quot;);                           &lt;3&gt;    </span><br><span class="line">template.findAllAndRemove(query(where(&quot;lastname&quot;).is(&quot;lannister&quot;), &quot;GOT&quot;);&lt;4&gt;  </span><br><span class="line">template.findAllAndRemove(new Query().limit(3), &quot;GOT&quot;);                  &lt;5&gt;</span><br><span class="line"></span><br><span class="line">Remove a single entity via its _id from the associated collection.</span><br><span class="line">Remove all documents matching the criteria of the query from the GOT collection.</span><br><span class="line">Remove the first 3 documents in the GOT collection. Unlike &lt;2&gt;, the documents to remove are identified via their _id executing the given query applying sort, limit and skip options first and then remove all at once in a separate step.</span><br><span class="line">Remove all documents matching the criteria of the query from the GOT collection. Unlike &lt;3&gt;, documents do not get deleted in a batch but one by one.</span><br><span class="line">Remove the first 3 documents in the GOT collection. Unlike &lt;3&gt;, documents do not get deleted in a batch but one by one.</span><br></pre></td></tr></table></figure></p>
<p>区别:<br>remove当有多个需要删除的记录时，一次删除；而findAllAndRemove则是一跳一条记录删除。</p>
<p>Upsert数据<br>如果数据库中没有该记录则插入数据库中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">template.upsert(query(where(&quot;ssn&quot;).is(1111).and(&quot;firstName&quot;).is(&quot;Joe&quot;).and(&quot;Fraizer&quot;).is(&quot;Update&quot;)), update(&quot;address&quot;, addr), Person.class);</span><br></pre></td></tr></table></figure></p>
<p>查找并修改数据：返回原值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;T&gt; T findAndModify(Query query, Update update, Class&lt;T&gt; entityClass);</span><br><span class="line"></span><br><span class="line">&lt;T&gt; T findAndModify(Query query, Update update, Class&lt;T&gt; entityClass, String collectionName);</span><br><span class="line"></span><br><span class="line">&lt;T&gt; T findAndModify(Query query, Update update, FindAndModifyOptions options, Class&lt;T&gt; entityClass);</span><br><span class="line"></span><br><span class="line">&lt;T&gt; T findAndModify(Query query, Update update, FindAndModifyOptions options, Class&lt;T&gt; entityClass, String collectionName);</span><br></pre></td></tr></table></figure>
<p>如果想返回新值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p = template.findAndModify(query, update, new FindAndModifyOptions().returnNew(true), Person.class);</span><br></pre></td></tr></table></figure></p>
<p>The FindAndModifyOptions lets you set the options of returnNew, upsert, and remove.</p>
<p>查找数据：[TODO review]</p>
<ol>
<li><p>BasicQuery用于直接处理mongo的查找语句。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BasicQuery query = new BasicQuery(&quot;&#123; age : &#123; $lt : 50 &#125;, accounts.balance : &#123; $gt : 1000.00 &#125;&#125;&quot;);</span><br><span class="line">List&lt;Person&gt; result = mongoTemplate.find(query, Person.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p>标准面向对象的Query方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Criteria all (Object o) Creates a criterion using the $all operator</span><br><span class="line">Criteria and (String key) Adds a chained Criteria with the specified key to the current Criteria and returns the newly created one</span><br><span class="line">Criteria andOperator (Criteria…​ criteria) Creates an and query using the $and operator for all of the provided criteria (requires MongoDB 2.0 or later)</span><br><span class="line">Criteria elemMatch (Criteria c) Creates a criterion using the $elemMatch operator</span><br><span class="line">Criteria exists (boolean b) Creates a criterion using the $exists operator</span><br><span class="line">Criteria gt (Object o) Creates a criterion using the $gt operator</span><br><span class="line">Criteria gte (Object o) Creates a criterion using the $gte operator</span><br><span class="line">Criteria in (Object…​ o) Creates a criterion using the $in operator for a varargs argument.</span><br><span class="line">Criteria in (Collection&lt;?&gt; collection) Creates a criterion using the $in operator using a collection</span><br><span class="line">Criteria is (Object o) Creates a criterion using field matching (&#123; key:value &#125;). If the specified value is a document, the order of the fields and exact equality in the document matters.</span><br><span class="line">Criteria lt (Object o) Creates a criterion using the $lt operator</span><br><span class="line">Criteria lte (Object o) Creates a criterion using the $lte operator</span><br><span class="line">Criteria mod (Number value, Number remainder) Creates a criterion using the $mod operator</span><br><span class="line">Criteria ne (Object o) Creates a criterion using the $ne operator</span><br><span class="line">Criteria nin (Object…​ o) Creates a criterion using the $nin operator</span><br><span class="line">Criteria norOperator (Criteria…​ criteria) Creates an nor query using the $nor operator for all of the provided criteria</span><br><span class="line">Criteria not () Creates a criterion using the $not meta operator which affects the clause directly following</span><br><span class="line">Criteria orOperator (Criteria…​ criteria) Creates an or query using the $or operator for all of the provided criteria</span><br><span class="line">Criteria regex (String re) Creates a criterion using a $regex</span><br><span class="line">Criteria size (int s) Creates a criterion using the $size operator</span><br><span class="line">Criteria type (int t) Creates a criterion using the $type operator</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Person&gt; result = mongoTemplate.find(query(where(&quot;age&quot;).lt(50)</span><br><span class="line">  .and(&quot;accounts.balance&quot;).gt(1000.00d)), Person.class);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>其他find的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">`findAll` Query for a list of objects of type T from the collection.</span><br><span class="line">`findOne` Map the results of an ad-hoc query on the collection to a single instance of an object of the specified type.</span><br><span class="line">`findById` Return an object of the given id and target class.</span><br><span class="line">`find` Map the results of an ad-hoc query on the collection to a List of the specified type.</span><br><span class="line">`findAndRemove` Map the results of an ad-hoc query on the collection to a single instance of an object of the specified type. The first document that matches the query is returned and also removed from the collection in the database.</span><br></pre></td></tr></table></figure>
</li>
<li><p>TextQuery</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TextQuery.searching(new TextCriteria().matching(&quot;coffee&quot;).matching(&quot;-cake&quot;));</span><br><span class="line">TextQuery.searching(new TextCriteria().matching(&quot;coffee&quot;).notMatching(&quot;cake&quot;));</span><br></pre></td></tr></table></figure>
</li>
<li><p>Query by Example（QBE）<br><a href="https://docs.spring.io/spring-data/mongodb/docs/2.0.5.RELEASE/reference/html/#query-by-example" target="_blank" rel="noopener">TODO</a></p>
</li>
</ol>
<h4 id="2-3-使用Spring-Data-Repositories"><a href="#2-3-使用Spring-Data-Repositories" class="headerlink" title="2.3 使用Spring Data Repositories"></a>2.3 使用Spring Data Repositories</h4><p>Repositories只是作为一个Spring-data的一个标示，同时也是其的一个核心借口，内部不存在方法，所有的方法都是通过Spring的内部注入机制注入。<br>在Repositories上层是CrudRepository。CrudRepository借口定义了几个基本的方法。spring-data同时提供JpaRepository,MongoRepository接口，屏蔽了底层实现逻辑。<br>在CrudRepository上层是PagingAndSortingRepository，该接口定义了分页查询等接口。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/spring/" rel="tag"># spring</a>
          
            <a href="/tags/mongodb/" rel="tag"># mongodb</a>
          
            <a href="/tags/spring-boot/" rel="tag"># spring-boot</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/06/2018-03-06-java-web/" rel="next" title="企业级引用系统开发技术(1)">
                <i class="fa fa-chevron-left"></i> 企业级引用系统开发技术(1)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/06/2018-03-06-随手/" rel="prev" title="常用代码">
                常用代码 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Tbxsx</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#spring-data-mongodb"><span class="nav-number">1.</span> <span class="nav-text">spring-data-mongodb</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-mapping-定义Document"><span class="nav-number">1.1.</span> <span class="nav-text">1. mapping(定义Document)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-id字段的映射"><span class="nav-number">1.1.1.</span> <span class="nav-text">1.1 _id字段的映射</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-映射的type对应"><span class="nav-number">1.1.2.</span> <span class="nav-text">1.2 映射的type对应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-3-注解-Mapping-annotation-overview"><span class="nav-number">1.1.3.</span> <span class="nav-text">1.3 注解(Mapping annotation overview)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-操作Mongodb"><span class="nav-number">1.2.</span> <span class="nav-text">2. 操作Mongodb</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-连接Mongodb"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1 连接Mongodb</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-使用MongoTemple"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2 使用MongoTemple</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-使用Spring-Data-Repositories"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3 使用Spring Data Repositories</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tbxsx</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
